<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>Space Invaders</title>
     <style>
     canvas{

          background-color: #000;
          display: block;
          position: absolute;
          margin: auto;
          top: 0;
          bottom: 0;
          left: 0;
          right: 0;
     }
     </style>
</head>
<body>

<script src="js/index.js"></script>
<script type="text/javascript">
var screen, input, frames, spFrame, lvFrame;
var alSprite, taSprite, ciSprite;
var aliens, dir, tank, bullets, cities;

function main(){
     screen = new Screen(510, 600);
     input = new InputHandeler();

     var img = new Image();
     img.addEventListener("load", function(){
          alSprite = [
               [new Sprite(this, 0, 0, 22, 16), new Sprite(this, 0, 16, 22, 16)],
               [new Sprite(this, 22, 0, 16, 16), new Sprite(this, 22, 16, 16, 16)],
               [new Sprite(this, 38, 0, 24, 16), new Sprite(this, 38, 16, 24, 16)]
          ];
          taSprite = new Sprite(this, 62, 0, 22, 16);
          ciSprite = new Sprite(this, 84, 8, 36, 24);

          init();
          run();
     });
     img.src = "http://i.imgur.com/js5FWbD.png"
};

function init(){
     frames = 0;
     spFrame = 0;
     lvFrame = 60;
     dir = 1;

     aliens = [];
     var rows = [1, 0, 0, 2, 2];
     for (var i = 0, len = rows.length; i < len; i++){
          for (var j=0; j < 10; j++){
               var a = rows[i];
               aliens.push({
                    sprite: alSprite[a],
                    x: 30 + j*30 + [0, 4, 0][a],
                    y: 30 + i*30,
                    w: alSprite[a][0].w,
                    h: alSprite[a][0].h
               });
          }
     }
};
function run(){
     var loop = function(){
          update();
          render();

          window.requestAnimationFrame(loop, screen.canvas);
     };
     window.requestAnimationFrame(loop, screen.canvas);
};
function update(){
     frames++;
     if(frames % lvFrame === 0){
          spFrame = (spFrame + 1)%2;
          for (var i = 0, len = aliens.length; i < len; i++){
               var a = aliens[i];
               a.x += 30 * dir;
          }
     }
};
function render(){
     screen.clear();
     for(var i = 0, len = aliens.length; i < len; i++){
          var a = aliens[i];
          screen.drawSprite(a.sprite[spFrame], a.x, a.y);
     }
};
main();
</script>
</body>
</html>
